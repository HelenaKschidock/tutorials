name: Run tutorials with all components from containers
on:
  push:
    branches:
      - add-nightly-tests
jobs:
  run-flow-over-heated-plate:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/precice/openfoam-adapter:latest
      options: --user precice
    steps:
      - name: Get ownership of workspace
        run: sudo chown -R $USER:$USER /__w/tutorials/
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Run an OpenFOAM-OpenFOAM case
        run: |
          export USER=precice
          openfoam2012 env
          cd flow-over-heated-plate/
          (cd fluid-openfoam && /usr/bin/openfoam2012 ./run.sh &)
          (cd solid-openfoam && /usr/bin/openfoam2012 ./run.sh &)  
        